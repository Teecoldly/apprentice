<!DOCTYPE html>
<html lang="en">

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title><%- include("title.ejs") %> </title>
	<!-- base:css -->
	<link rel="stylesheet" href="/vendors/mdi/css/materialdesignicons.min.css">
	<link rel="stylesheet" href="/vendors/base/vendor.bundle.base.css">
	<!-- endinject -->
	<!-- plugin css for this page -->
	<!-- End plugin css for this page -->
	<!-- inject:css -->
	<link rel="stylesheet" href="/css/style.css">
	<!-- endinject -->
	<script src="/js/jquery.js"></script>
	<link rel="shortcut icon" href="/images/favicon.png" />
	<link href="/fonts/fontawesome-free-5.13.0-web/css/fontawesome.css" rel="stylesheet">
	<link href="/fonts/fontawesome-free-5.13.0-web/css/brands.css" rel="stylesheet">
	<link href="/fonts/fontawesome-free-5.13.0-web/css/solid.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>

	<link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css">
	<style>
		.sale-red:after {
			content: '';
			height: 5px;
			width: 100%;
			border-radius: 0 0 6px 6px;
			background-color: red;
			position: absolute;
			left: 0;
			bottom: 0;
		}

		.sale-pink:after {
			content: '';
			height: 5px;
			width: 100%;
			border-radius: 0 0 6px 6px;
			background-color: pink;
			position: absolute;
			left: 0;
			bottom: 0;
		}

		.sale-green:after {
			content: '';
			height: 5px;
			width: 100%;
			border-radius: 0 0 6px 6px;
			background-color: green;
			position: absolute;
			left: 0;
			bottom: 0;
		}

		.sale-black:after {
			content: '';
			height: 5px;
			width: 100%;
			border-radius: 0 0 6px 6px;
			background-color: black;
			position: absolute;
			left: 0;
			bottom: 0;
		}

		.locksize {
			width: 60%;
			min-width: 20em;
			/* Will be AT LEAST 20em wide */
		}
	</style>
</head>

<body>
	<div class="container-scroller">

		<!-- partial:partials/_horizontal-navbar.html -->
		<div class="horizontal-menu">
			<nav class="navbar top-navbar col-lg-12 col-12 p-0">
				<div class="container-fluid">
					<div class="navbar-menu-wrapper d-flex align-items-center justify-content-between">
						<ul class="navbar-nav navbar-nav-left">
							<div
								class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center">
								<a class="navbar-brand brand-logo" href="/">CRS System</a>
								<a class="navbar-brand brand-logo-mini" href="/"> CRS System</a>
							</div>
						</ul>
						<%- include('nav_user',{name:name}) %>

						<button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button"
							data-toggle="horizontal-menu-toggle">
							<span class="mdi mdi-menu"></span>
						</button>
					</div>
				</div>
			</nav>
			<nav class="bottom-navbar">
				<%- include('menubar',{level:level}) %>
			</nav>
		</div>
		<% 
		 function getstatus(diff_number) {
        	let time= diff_number/1000;
            	if( parseInt(time=time/60)<=0){
                    return 3
                }else if (parseInt(time)>=0 && parseInt(time)<=15){
                    return 2
                } else {
                    return 1
                }
		}
		%>
		<!-- partial -->
		<div class="container-fluid page-body-wrapper">
			<div class="main-panel">
				<div class="content-wrapper">
					<div class="row">
						<div class="col-sm-12 mb-4 mb-xl-0">
							<div class="d-lg-flex align-items-center">
								<div>
									<h3 class="text-dark font-weight-bold mb-2">ยินดีต้อนรับคุณ <%= name %> !</h3>

								</div>

							</div>
						</div>

					</div>
					<%  %>
			 
					<%- include('control/admin/dashbord',{level:level}) %>
					 
					<% if(level!=1){ %>
					<div class="row mt-3">
						<div class="col-sm-12  ">
							<div class="row">
								<div class="col-lg-3 d-flex grid-margin stretch-card">
									<div class="card sale-visit-statistics-border ">
										<div class="card-body">
											<h2 class="text-dark mb-2 font-weight-bold"> <span style=" color:blue ;"> <i
														class="fas fa-users "></i></span> <%= project[0] %> </h2>
											<h4 class="card-title mb-2">จำนวนกลุ่มโปรเจค</h4>

										</div>
									</div>
								</div>
								<div class="col-lg-3 d-flex grid-margin stretch-card">
									<div class="card sale-black">
										<div class="card-body">
											<h2 class="text-dark mb-2 font-weight-bold"> <span style=" color:#17a2b8 ;">
													<i class="fas fa-scroll"></i></span> <%= project[1] %></h2>
											<h4 class="card-title mb-2">จำนวนการสอบ</h4>

										</div>
									</div>
								</div>
								<div class="col-lg-3 d-flex grid-margin stretch-card">
									<div class="card sale-green">
										<div class="card-body">
											<h2 class="text-dark mb-2 font-weight-bold"> <span style=" color:#28a745 ;">
													<i class="fas fa-check-square "></i></span> <%= project[3] %></h2>
											<h4 class="card-title mb-2">จำนวนการสอบเสร็จสิ้น</h4>

										</div>
									</div>
								</div>
								<div class="col-lg-3 d-flex grid-margin stretch-card">
									<div class="card  sale-red">
										<div class="card-body">
											<h2 class="text-dark mb-2 font-weight-bold"><span style=" color:red ;"><i
														class="fas fa-clock"></i></span> <%= project[2] %></h2>
											<h4 class="card-title mb-2">จำนวนการสอบยังไม่เสร็จสิ้น</h4>

										</div>
									</div>
								</div>
							</div>
						</div>

					</div>
					<% } %>
					<% if(level==1){ %>
						<div class="row mt-3">
							<div class="col-lg-12 d-flex grid-margin stretch-card text-center">
								<div class="card sale-pink">
									<div class="card-body">
										<h2 class="text-dark mb-2 font-weight-bold"><span  style=" color:red ;">   <i class="fa fa-users"></i></span>
											 <span > 
												 กลุ่ม  <% if(level==1){%>
													 <%- name_group %>  
													 <% }  %>
											 </span> 
											</h2>
										 
									</div>
								</div>
							</div>
						</div>
					<div class="row mt-3">
						<div class="col-lg-12 grid-margin stretch-card">
							<div class="card">
								<div class="card-body">
									<h4 class="card-title">ตารางสอบ</h4>
									<div class="table-responsive">
										<table class="table table-striped text-center " id="event_student">
											<thead>
												<tr>
													<th>
														ลำดับ
													</th>
													<th>
														ห้องหรือคำอธิบาย
													</th>
													<th>
														วันเวลา
													</th>
													<th>

													</th>

												</tr>
											</thead>
											<tbody>

												<% let i=1; %>
												<% student.forEach(element => { %>
												<% 
											let date_now = new Date();
											let date = new Date(element.date_timestemp)
											let result = getstatus((date-date_now ))
											
										 
											%>
												<% let date15 = new Date(date);%>
												<%  date15.setMinutes(date.getMinutes()+15)%>

												<% 	if(result==1){ %>
												<tr>
													<td class="align-middle"><%= i++ %> </td>
													<td class="align-middle"><%= element.room %> </td>
													<td class="align-middle">
														<%= date.getDate().toFixed()+"-"+ (date.getMonth()+1)+"-"+date.getFullYear()+" "+  (date.getHours()<10?'0':'') + date.getHours()  +':'+(date.getMinutes()<10?'0':'') + date.getMinutes() %>
														<br>ถึง<br>
														<%= date15.getDate()+"-"+( date15.getMonth()+1)+"-"+date15.getFullYear()+" "+ (date15.getHours()<10?'0':'') + date15.getHours()+':'+(date15.getMinutes()<10?'0':'') + date15.getMinutes() %>
													</td>
													<td class="align-middle"> <button type="button" class="btn btn-info"
															data-temp_time="<%= date.getDate().toFixed()+"-"+ (date.getMonth()+1)+"-"+date.getFullYear()+" "+  (date.getHours()<10?'0':'') + date.getHours()  +':'+(date.getMinutes()<10?'0':'') + date.getMinutes() %>"
															data-evetid="<%= element.event_id %>"
															id="book_event">จองสอบ</button></td>
												</tr>

												<% } %>

												<% }) %>

											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>



					<div class="row mt-3">
						<div class="col-lg-12 grid-margin stretch-card">
							<div class="card">
								<div class="card-body">
									<h4 class="card-title">ประวัติการสอบ</h4>
									<div class="table-responsive">
										<table class="table table-striped text-center " id="history_event">
											<thead>
												<tr>
													<th>
														ลำดับ
													</th>
													<th>
														วันเวลา
													</th>
													<th>
														ผลการสอบ
													</th>

												</tr>
											</thead>
											<tbody>
												<% let v = 1 ;  %>
												​ <% event_Student.forEach(element => { %>
													<%  let date = new Date(element.date_timestemp); %>

												<tr>
													<td class="align-middle"> <%= v++ %> </td>
													<td class="align-middle">
														<%= date.getDate().toFixed()+"-"+ (date.getMonth()+1)+"-"+date.getFullYear()+" "+ " " + (date.getHours() < 10 ? '0' : '') + date.getHours() + ':' + (date.getMinutes() < 10 ? '0' : '') + date.getMinutes()     %>
													</td>
													<td class="align-middle locksize"> <%=  element.comment %> </td>

												</tr>
												<% }) %>

											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>
					<% } %>
					<%  if(level==2){ %>
					<div class="row mt-3">
						<div class="col-lg-12 grid-margin stretch-card">
							<div class="card">
								<div class="card-body">
									<h4 class="card-title">ตารางมีการสอบของคุณ</h4>
									<div class="table-responsive">
										<table class="table table-striped text-center " id="schedule_techer">
											<thead>
												<tr>
													<th>
														ลำดับ
													</th>
													<th>
														กลุ่ม
													</th>
													<th>
														ห้องหรือคำอธิบาย
													</th>
													<th>
														วันเวลา
													</th>
													<th>
														สถานะการสอบ
													</th>

												</tr>
											</thead>
											<tbody>
												<%  let i=1 ; %>
												<% techer_schedule.forEach(element => { %>
												<%  let date = new Date(element.date_timestemp);
													let date_now = new Date();
													 let result = getstatus((date-date_now ))
													%>
												<tr>
													<td class="align-middle"><%= (i++) %> </td>
													<td class="align-middle"><%= (element.project_name) %> </td>
													<td class="align-middle"><%= (element.room) %> </td>
													<td class="align-middle">
														<%= date.getDate().toFixed()+"-"+ (date.getMonth()+1)+"-"+date.getFullYear()+" "+ " " + (date.getHours() < 10 ? '0' : '') + date.getHours() + ':' + (date.getMinutes() < 10 ? '0' : '') + date.getMinutes()     %>
													</td>
													<td class="align-middle">
														<% if(result==1 ){ %>
															<span class='text-primary'>การสอบรอการดำเนินการ </span>
														<% }else if(result ==2 ){ %>
															<span class='text-warning'>การสอบกำลังดำเนินการ </span>
														<% }else if(result ==3){ %>
															<span class='text-success'>การสอบสิ้นสุดลงแล้ว </span>
														<% } %>

													</td>
												</tr>
												<% }) %>


											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>
					<% } %>
				</div>
				<!-- content-wrapper ends -->
				<!-- partial:partials/_footer.html -->

				<!-- partial -->
			</div>
			<!-- main-panel ends -->
		</div>
		<%- include('footter') %>
		<!-- page-body-wrapper ends -->
	</div>

	<% if(level==1){ %>

	<div class="modal fade" id="authen_model" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
		aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">กรุณายืนยันตัวนักศึกษา</h5>

				</div>
				<div class="modal-body">
					<div class="form-group">
						<label for="">วันเวลาเปิดสอบ</label>
						<input class="form-control" type="number" placeholder="กรุณากรอกรหัสประจำตัวนักศึกษา"
							id="id_card">
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" id="sigout">ออกจากระบบ</button>
					<button type="button" class="btn btn-primary" id="config">ยืนยัน</button>
				</div>
			</div>
		</div>
	</div>


	<% } %>
	<!-- container-scroller -->
	<!-- base:js -->
	<script src="vendors/base/vendor.bundle.base.js"></script>
	<!-- endinject -->
	<!-- Plugin js for this page-->
	<!-- End plugin js for this page-->
	<!-- inject:js -->
	<script src="js/template.js"></script>
	<!-- endinject -->
	<!-- plugin js for this page -->
	<!-- End plugin js for this page -->
	<script src="vendors/chart.js/Chart.min.js"></script>
	<script src="vendors/progressbar.js/progressbar.min.js"></script>
	<script src="vendors/chartjs-plugin-datalabels/chartjs-plugin-datalabels.js"></script>
	<script src="vendors/justgage/raphael-2.1.4.min.js"></script>
	<script src="vendors/justgage/justgage.js"></script>
	<!-- Custom js for this page-->
	<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
	<script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>

	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
	<script src="js/index.js"></script>
	<%- 
	include("control/setting")
	 %>
	<!-- End custom js for this page-->

</body>

</html>